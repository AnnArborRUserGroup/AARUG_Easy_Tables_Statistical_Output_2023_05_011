---
title: Easy Tables from Statistical Output (web version)
author: "Barry DeCicco"
date: "For Ann Arbor R Users' Group Meetup, May 11, 2023"
output:  
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    number_sections: true
    code_folding:  hide
    

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r load-libraries, include=FALSE}

# load libraries as needed:

library(tidyverse)
library(janitor)
library(kableExtra)
library(magrittr)
library(tidyverse)
library(summarytools)
library(xtable)
library(broom)
library(tidyr)
library(foreign)
library(haven)


```


# Making tables from Statistical Output

Copying and pasting statistical output is time-consuming
and prone to errors.  When multiple analyses need to be run,
it's even worse.

R has multiple ways to extract organized statistical ouput into data frames or tables. At that point the information is easily understood 
and renderable in documents and presentations.

 This presentation will cover {.flexbox .vcenter}

*   The nature of R statistical output and how to explore it
and extract items 'by hand'.

*   How to use the **xtable** pacakge to extract and organize output.<p>

*   How to use the **broom** package to clean and tidy output.<p>

*   How to make tables look better with the kable and KableExtra packages.<p>



# Data - bodyfat.sav:

*   This presentation will use the 'BodyFat' data set built used as a sample set for SPSS (available at http://calcnet.mth.cmich.edu/org/spss/prjs_datasets.htm )



```{r load-bodyfat-data-set, echo = TRUE}


bodyfat_df <- read_sav("bodyfat.sav")

```

## Body Fat Data Set:

```{r print-bodyfat-data-set, echo = TRUE}

print(bodyfat_df)

```


# Basic Structure of Output


 - Assign the output of a model to an object.
 - Use 'class()' to find out the class of the output object (you can then google it)
 - Use the 'names()' function to find the names of the major components of the object.
 - Use the 'str()' to get a breakdown of the object's components

## Simple Linear Model

Typing the object's name gives some basic information.

```{r run-lm, echo =TRUE}

lm1 <- lm(y ~ x1, data= bodyfat_df)

```


```{r print-lm, echo =TRUE}

lm1 

```


```{r class-lm, echo =TRUE}

class(lm1)

```


```{r names-lm, echo =TRUE}

names(lm1)

```


```{r str-lm, echo =TRUE}

str(lm1)

```

## Adding to the Basic Tables, using 'Adorn':

  * The Adorn commands can be used on data frames
  
  * The output of the tabyl() command can be converted to a data frame using
  the command as.data.frame()


```{r tabyl_2, echo =TRUE}



mtcars %>% 
  tabyl(gear, cyl, show_NA = TRUE) %>% 
  adorn_totals(where="row")




```




# What Else Can You Do with the Results?

You can use the command '' to export the table to a file, if you would like to
use it separately:

save_kable(file = "table1.html", self_contained = T)


```{r kableExtra_11, echo =TRUE, eval=TRUE}


title_date = format(Sys.time(), '%d %B, %Y')

T1cap <- paste0("<center><strong>TITLE TEXT GOES HERE,<br/>", title_date, "</strong></center>>")
FN1   <- paste("<strong>FOOTNOTE TEXT GOES HERE</strong>")
mtcars            %>% 
  kable(caption = T1cap, 
        escape = FALSE,
        col.names = c(
                      "Miles per<br/>Gallon",
                      "Cylinders",
                      "Displacement",
                      "Horsepower",
                      "Rear Axle<br/>Ratio",
                      "Weight",
                      "Quarter Mile<br/>
                      Seconds",
                      "V vs Straight<br/>Line",
                      "Automatic vs <br/> Manual Transmission",
                      "Gear",
                      "Carburetors"
                      ))              %>%
  kable_styling(bootstrap_options = 
                  c("striped", "hover", "condensed", "responsive",
                    full_width = F, position = "center")
                ) %>% 
  column_spec(1, width = "3cm",bold = TRUE) %>%   
  column_spec(2:5, width = "3cm") %>% 
  kable_styling(fixed_thead = T)  %>% 
  add_header_above(c(" " = 2, "Middle 4 Columns" = 4, 
                     "Last 5 Columns" = 5, " ")) %>% 
  add_header_above(c(" " = 4, "Group 1" = 5, " " = 3)) %>%
  add_header_above(c(" "=1,"Everything" = 11)) %>% 
  footnote(general = FN1, general_title = "Note: ", footnote_as_chunk = TRUE) %>% 
  scroll_box(width = "75%", height = "500px") %>% 
  save_kable(file = "table1.html", self_contained = T)
 



```

# Using Kable with Other Packages.

Some other packages have an '...2kable() function to allow you to use kable:

xtable2able()
For the 'table' package, use toKable()

## Other things: 

- Formatting headers (e.g., a higher row covering groups of variables)
- Controlling the cells (e.g., conditional highlighting).
- Linking to other locations.





# Questions?

# References:

 - The janitor package vignette:  https://garthtarr.github.io/meatR/janitor.html
 
 - The kableExtra package:  https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html
 


    

